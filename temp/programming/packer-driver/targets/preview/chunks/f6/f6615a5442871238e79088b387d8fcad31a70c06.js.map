{"version":3,"sources":["file:///E:/lianlukeji/frontend/cocos/menghuanfarm/assets/code/genPlant.ts"],"names":["_decorator","Component","Node","find","Layers","UITransform","Sprite","SpriteFrame","resources","Button","instantiate","Label","main","timer","ccclass","property","genPlant","addPlants","plantType","shouhuoQiPao","maps","children","shouhuoCount","forEach","m","index","plants","clone_item","layer","Enum","UI_2D","setParent","name","addComponent","getComponent","transition","Transition","SCALE","setPosition","position","x","y","setContentSize","load","img","err","spriteFrame","sizeMode","SizeMode","CUSTOM","shouhuo","active","_genPlant","schedule","time","chengshuImg","getChildByName","string","on","EventType","TOUCH_END","mySaleBoxItems","length","showMsg","addSalePackCount","addSalePack","isStart","saleBox","removeChild","addChild","msg","msgBox","mg","scheduleOnce","callback"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, find, Layers, UITransform, Sprite, SpriteFrame, resources, Button, EventTouch, Scheduler, instantiate, tween, Label } from 'cc';\r\nimport { main } from './main';\r\nimport { timer } from './timer';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('genPlant')\r\nexport class genPlant extends Component {\r\n    public static _genPlant: genPlant = new genPlant();\r\n    //当前植物种类。播种的时候修改这个属性，6块地种植一样类型的作物\r\n    public addPlants(plantType) {\r\n        const shouhuoQiPao = find(\"MainCanvas/qipao/time\");\r\n        const maps = find(\"MainCanvas/map\").children;\r\n        let shouhuoCount = 0;\r\n        maps.forEach((m, index) => {\r\n            let plants = find(\"MainCanvas/plant\");\r\n            let clone_item = new Node();\r\n            clone_item.layer = Layers.Enum.UI_2D;\r\n            clone_item.setParent(m);\r\n            clone_item.name = plantType.name;\r\n            clone_item.addComponent(UITransform).addComponent(Sprite).addComponent(Button);\r\n            clone_item.getComponent(Button).transition = Button.Transition.SCALE;\r\n            clone_item.setPosition(m.position.x - 10, m.position.y + 112 / 2 - 10, 0);\r\n            clone_item.getComponent(UITransform).setContentSize(89, 112);\r\n            resources.load(plantType.img + \"/spriteFrame\", SpriteFrame, (err, spriteFrame) => {\r\n                clone_item.getComponent(Sprite).sizeMode = Sprite.SizeMode.CUSTOM;\r\n                clone_item.getComponent(Sprite).spriteFrame = spriteFrame;\r\n            });\r\n            let shouhuo = new Node();\r\n            shouhuo = instantiate(shouhuoQiPao);\r\n            shouhuo.layer = Layers.Enum.UI_2D;\r\n            shouhuo.setParent(m);\r\n            shouhuo.active = true;\r\n            shouhuo.addComponent(UITransform).addComponent(Button);\r\n            shouhuo.getComponent(UITransform).setContentSize(50, 50);\r\n            shouhuo.setPosition(clone_item.position.x - 70, clone_item.position.y, 0);\r\n            genPlant._genPlant.schedule(() => {\r\n                if (timer.time <= 0) {\r\n                    resources.load(plantType.chengshuImg + \"/spriteFrame\", SpriteFrame, (err, spriteFrame) => {\r\n                        clone_item.getComponent(Sprite).sizeMode = Sprite.SizeMode.CUSTOM;\r\n                        clone_item.getComponent(Sprite).spriteFrame = spriteFrame;\r\n                    });\r\n                    shouhuo.getChildByName(\"txt\").getComponent(Label).string = \"收获\";\r\n                } else {\r\n                    shouhuo.getChildByName(\"txt\").getComponent(Label).string = timer.time + \"秒\";\r\n                }\r\n            }, 1);\r\n\r\n            //收获果实 进背包\r\n            shouhuo.on(Node.EventType.TOUCH_END, () => {\r\n                if (timer.time < 0) {\r\n                    const mySaleBoxItems = find(\"MainCanvas/popBox/mysalepack/items\");\r\n                    if (mySaleBoxItems.children.length > 4) {\r\n                        this.showMsg(\"果实尚未出售完毕！\");\r\n                        return;\r\n                    }\r\n                    //收获6块地的果实只允许入包一次\r\n                    if (clone_item.name === \"fanqie\") {\r\n                        //场景中默认有4个Node所以从第5个开始属于背包items\r\n                        //并且6个收获按钮都点击后才可以入包\r\n                        if (main.addSalePackCount === 4) {\r\n                            this.showMsg(\"果实背包已满！\");\r\n                            return;\r\n                        }\r\n                        main.addSalePack(10);\r\n                        //收获后需要修改初始化计时器\r\n                        timer.isStart = false;\r\n                    } if (clone_item.name === \"pingguo\") {\r\n                        if (main.addSalePackCount === 4) {\r\n                            this.showMsg(\"果实背包已满！\");\r\n                            return;\r\n                        }\r\n                        main.addSalePack(11);\r\n                        //收获后需要修改初始化计时器\r\n                        timer.isStart = false;\r\n                    } if (clone_item.name === \"qiezi\") {\r\n                        if (main.addSalePackCount === 4) {\r\n                            this.showMsg(\"果实背包已满！\");\r\n                            return;\r\n                        }\r\n                        main.addSalePack(12);\r\n                        //收获后需要修改初始化计时器\r\n                        timer.isStart = false;\r\n                    } if (clone_item.name === \"huluobo\") {\r\n                        if (main.addSalePackCount === 4) {\r\n                            this.showMsg(\"果实背包已满！\");\r\n                            return;\r\n                        }\r\n                        main.addSalePack(13);\r\n                        //收获后需要修改初始化计时器\r\n                        timer.isStart = false;\r\n                    }\r\n                    main.saleBox.active = false;\r\n                    shouhuo.active = false;\r\n                    //收获后 地块移除所有的克隆果实\r\n                    plants.removeChild(clone_item);\r\n                }\r\n            }, this);\r\n            plants.addChild(shouhuo);\r\n            plants.addChild(clone_item);\r\n        });\r\n\r\n    }\r\n    //弹消息\r\n    showMsg(msg: string) {\r\n        const msgBox = find(\"MainCanvas/popBox/msgBox\");\r\n        const mg = msgBox.getChildByName(\"msgTxt\").getComponent(Label);\r\n        mg.string = msg;\r\n        msgBox.active = true;\r\n        this.scheduleOnce(function callback() {\r\n            msgBox.active = false;\r\n        }, 1);\r\n    }\r\n}\r\n\r\n"]}